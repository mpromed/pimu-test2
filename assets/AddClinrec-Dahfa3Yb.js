import{_ as F,r as I,c as p,a as o,b as d,u as t,F as f,d as g,w as r,e as U,E as v,f as P,g as S,o as u,h as $,i as y,j as b,k as V,l as n,m as c,n as _,p as A,q as x,t as R}from"./index-BGWPEtOe.js";const M={class:"container"},q={class:"form"},L={class:"form-group"},T={class:"form-group"},X={class:"form-group"},j={class:"icd-codes row"},H={class:"inline-form"},O={class:"form-group row"},Z={class:"column"},G={class:"column"},J={class:"column"},K={class:"form-group row"},Q={class:"column"},W={class:"column"},h={class:"column"},ee={class:"form-group"},le={key:0,class:"uploaded-files"},ae={class:"button-group"},se={__name:"AddClinrec",setup(oe){const l=I({documentId:"",diseaseName:"",icdCodes:[""],ageCategory:"",status:"",usage:"",approvalYear:"",revisionYear:"",datePublication:"",pdf_file:null}),m=I([]),C=Array.from({length:7},(s,e)=>2024-e),w=s=>{const e=s.type==="application/pdf",a=s.size/1024/1024<5;return e?a?!0:(v.error("Файл должен быть меньше 5MB!"),!1):(v.error("Только PDF файлы разрешены!"),!1)},D=async s=>{try{l.value.pdf_file=s.file}catch(e){console.error("Ошибка загрузки файла:",e),v.error("Ошибка при загрузке файла!")}},N=()=>{l.value.icdCodes.push("")},Y=s=>{if(!s)return"";const e=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");return`${e}-${a}-${i}`},E=s=>{const e=l.value.icdCodes[s];e&&!/^[A-Z]\d{1,2}(\.\d{1})?$/.test(e)&&(v.error("Неверный формат кода МКБ. Ожидается формат X9 или X9.9."),l.value.icdCodes[s]="")},z=async()=>{if(!l.value.pdf_file){v.error("Необходимо загрузить PDF-файл!");return}try{const s=new FormData;s.append("document_id",l.value.documentId),s.append("name",l.value.diseaseName),l.value.icdCodes.forEach((a,i)=>{s.append(`mkb_code_list[${i}]`,a)}),s.append("age_category",l.value.ageCategory),s.append("pdf_file",l.value.pdf_file),s.append("date_publication",Y(l.value.datePublication)),s.append("revision_year",l.value.revisionYear),s.append("approval_year",l.value.approvalYear),s.append("status",l.value.status),s.append("usage",l.value.usage);const e=await P.createDocument(s);v.success("Данные успешно сохранены!"),S.push("/")}catch(s){console.error("Ошибка сохранения данных:",s),v.error("Ошибка при сохранении данных!")}},B=()=>{l.value={documentId:"",diseaseName:"",icdCodes:[""],ageCategory:"",status:"",usage:"",approvalYear:"",revisionYear:"",pdf_file:null},m.value=[]};return(s,e)=>(u(),p("div",M,[e[22]||(e[22]=o("img",{src:$,alt:"Логотип",class:"logo"},null,-1)),e[23]||(e[23]=o("h1",{class:"title"},"Добавить клинические рекомендации",-1)),o("div",q,[o("div",L,[e[8]||(e[8]=o("label",{for:"documentId",class:"label"},"ID документа",-1)),d(t(y),{id:"documentId",modelValue:l.value.documentId,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.documentId=a),class:"input",placeholder:"Введите ID документа",style:{width:"15vw"}},null,8,["modelValue"])]),o("div",T,[e[9]||(e[9]=o("label",{for:"diseaseName",class:"label"},"Наименование заболевания",-1)),d(t(y),{id:"diseaseName",modelValue:l.value.diseaseName,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.diseaseName=a),class:"input",placeholder:"Введите наименование заболевания"},null,8,["modelValue"])]),o("div",X,[e[11]||(e[11]=o("label",{class:"label"},"Коды МКБ",-1)),o("div",j,[(u(!0),p(f,null,g(l.value.icdCodes,(a,i)=>(u(),p("div",{key:i,class:"code-wrapper"},[d(t(y),{modelValue:l.value.icdCodes[i],"onUpdate:modelValue":k=>l.value.icdCodes[i]=k,class:"input icd-input",placeholder:"Код МКБ",onBlur:k=>E(i)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]))),128)),d(t(V),{type:"primary",size:"large",class:"plus-button",onClick:N},{default:r(()=>e[10]||(e[10]=[b("+")])),_:1})])]),o("div",H,[o("div",O,[o("div",Z,[e[12]||(e[12]=o("label",{class:"label"},"Возрастная категория",-1)),d(t(c),{modelValue:l.value.ageCategory,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.ageCategory=a),class:"input",placeholder:"Выберите возрастную категорию",size:"large"},{default:r(()=>[d(t(n),{label:"Дети",value:"Дети"}),d(t(n),{label:"Взрослые",value:"Взрослые"}),d(t(n),{label:"Взрослые, Дети",value:"Взрослые, Дети"})]),_:1},8,["modelValue"])]),o("div",G,[e[13]||(e[13]=o("label",{class:"label"},"Статус",-1)),d(t(c),{modelValue:l.value.status,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.status=a),class:"input",placeholder:"Выберите статус",size:"large"},{default:r(()=>[d(t(n),{label:"Действует",value:"Действует"}),d(t(n),{label:"Утратил силу",value:"Утратил силу"})]),_:1},8,["modelValue"])]),o("div",J,[e[14]||(e[14]=o("label",{class:"label"},"Применение",-1)),d(t(c),{modelValue:l.value.usage,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.usage=a),class:"input",placeholder:"Выберите применение",size:"large"},{default:r(()=>[d(t(n),{label:"Применяется",value:"Применяется"}),d(t(n),{label:"Применение отложено",value:"Применение отложено"})]),_:1},8,["modelValue"])])])]),o("div",K,[o("div",Q,[e[15]||(e[15]=o("label",{class:"label"},"Год утверждения",-1)),d(t(c),{modelValue:l.value.approvalYear,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.approvalYear=a),placeholder:"Выберите год",class:"input",size:"large"},{default:r(()=>[(u(!0),p(f,null,g(t(C),a=>(u(),_(t(n),{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",W,[e[16]||(e[16]=o("label",{class:"label"},"Год пересмотра",-1)),d(t(c),{modelValue:l.value.revisionYear,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.revisionYear=a),placeholder:"Выберите год",class:"input",size:"large"},{default:r(()=>[(u(!0),p(f,null,g(t(C),a=>(u(),_(t(n),{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o("div",h,[e[17]||(e[17]=o("label",{class:"label"},"Дата публикации",-1)),d(t(A),{modelValue:l.value.datePublication,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.datePublication=a),type:"date",placeholder:"Выберите дату публикации",class:"input",style:{width:"100%",border:"1px solid #5677AC"},size:"large"},null,8,["modelValue"])])]),o("div",ee,[e[19]||(e[19]=o("label",{class:"label"},"Файл клинических рекомендаций",-1)),d(t(x),{class:"upload","http-request":D,"file-list":m.value,"before-upload":w,multiple:"false","show-file-list":""},{default:r(()=>[m.value.length===0?(u(),_(t(V),{key:0,class:"upload-button"},{default:r(()=>e[18]||(e[18]=[b("Загрузить")])),_:1})):U("",!0)]),_:1},8,["file-list"]),m.value.length>0?(u(),p("div",le,[(u(!0),p(f,null,g(m.value,a=>(u(),p("span",{key:a.name},R(a.name),1))),128))])):U("",!0)]),o("div",ae,[d(t(V),{type:"primary",class:"save-button",onClick:z},{default:r(()=>e[20]||(e[20]=[b(" Сохранить клинрек ")])),_:1}),d(t(V),{type:"danger",class:"cancel-button",onClick:B},{default:r(()=>e[21]||(e[21]=[b(" Отменить ")])),_:1})])])]))}},de=F(se,[["__scopeId","data-v-a7da7f48"]]);export{de as default};
